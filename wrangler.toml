name = "send-signaling"
main = "worker.js"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Serve static files from public/ — Worker handles /ice and /ws,
# everything else falls through to the static asset handler.
[assets]
directory = "./public"
binding = "ASSETS"
run_worker_first = ["/ice", "/ws"]

# Durable Objects — one instance per session ID, holds the signaling room state
[[durable_objects.bindings]]
name = "SIGNALING_ROOM"
class_name = "SignalingRoom"

# Required: declare the migration so Cloudflare registers the DO class
[[migrations]]
tag = "v1"
new_sqlite_classes = ["SignalingRoom"]

# TURN server credentials (optional — falls back to STUN-only if not set)
# Set via: npx wrangler secret put METERED_API_KEY
#          npx wrangler secret put METERED_APP_NAME
